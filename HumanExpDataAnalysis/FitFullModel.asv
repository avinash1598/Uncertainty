close all
clear all

addpath('C:\Users\avinash1598\Desktop\Uncertainty\ProcessModel\HumanExpDataAnalysis\Utils\')
addpath('C:\Users\avinash1598\Desktop\Uncertainty\Uncertainty\ProcessModel\LLScriptsUtils\')
addpath('C:\Users\avinash1598\Desktop\Uncertainty\ProcessModel\PlotUtils\')
addpath('C:\Users\avinash1598\Desktop\Uncertainty\ProcessModel\Utils\')
addpath('C:\Users\avinash1598\Desktop\Uncertainty\ProcessModel\OptimizationUtils\')
addpath('C:\Users\avinash1598\Desktop\Uncertainty\HumanExpDataAnalysis\Utils\')

% expData            = load('Data\CORNFB01.mat'); % Yichao
%expData            = load('./Data/COR33.mat'); % Akash
expData            = load('./Data/COR31.mat'); % Tien
% expData            = load('./Data/COR32.mat'); % Jiaming

fltData       = expData.dat( expData.dat.session > 0 , :); 
f.dat         = fltData;
formattedData = formatExpData(f, false, false); % no de-baising, work with raw errors

%%

errBins   = -90:1:90; % this is dx which might affect fitting. This value should be optimal. not too fine. not too coarse.

optParams.nStarts = 10;
optParams.hyperParamC1 = 0;
optParams.randomGuessModel = true;

result = Optimize(formattedData, errBins, "cov", [], optParams, "full");

%%
[~, idx] = min(result.f);

opt_param_sigma_s         = result.x(idx, 1:n_uncertainty_levels);
opt_param_scale           = result.x(idx ,n_uncertainty_levels + 1);
opt_param_sigma_meta      = result.x(idx, n_uncertainty_levels + 2);
opt_param_Cc              = result.x(idx, n_uncertainty_levels + 3);
opt_param_guessrate       = result.x(idx, n_uncertainty_levels + 4);
opt_param_sigma_ori_scale = result.x(idx, n_uncertainty_levels + 5);
opt_param_bias            = result.x(idx, n_uncertainty_levels + 6);


