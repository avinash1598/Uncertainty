close all
clear all

addpath('C:\Users\avinash1598\Desktop\Uncertainty\LLScriptsUtils\')
addpath('C:\Users\avinash1598\Desktop\Uncertainty\PlotUtils\')
addpath('C:\Users\avinash1598\Desktop\Uncertainty\Uncertainty\Utils\')
addpath('C:\Users\avinash1598\Desktop\Uncertainty\OptimizationUtils\')

modelData                            = load('../modelContOriData_cov.mat');
modelData.data.resp_err_all          = modelData.data.err;
modelData.data.confidence_report_all = modelData.data.confReport;

%% Cross-validate
errBins   = -90:0.1:90;
cv_result = NLLCrossValidate(modelData.data, errBins);
%%
save('./CV_Data/cross_validation_cov_model.mat', 'cv_result');

%% NLL on test data
nllData = computeNLL(formattedData, errBins, cv_result); % This will throw error

%%
figure
subplot(2, 2, 1)
hold on
histogram(nllData.nllCovModel/100, DisplayName='cov model')
histogram(nllData.nllIndModel/100, DisplayName='ind model')
hold off
ylabel("Count")
xlabel("NLL")
legend
title("Fit on test data (GT: cov model data)")

subplot(2, 2, 2)
histogram(nllData.deltaNLL) 
ylabel("Count")
xlabel("delta NLL (cov - ind)")
legend
title("Fit on test data (GT: cov model data)")

subplot(2, 2, 3)
hold on
bins = 0:30:300;
histogram(nllData.fvalsCov/100, bins, DisplayName='cov model')
histogram(nllData.fvalsInd/100, bins, DisplayName='ind model')
hold off
ylabel("Count")
xlabel("NLL")
legend
title("fvals (train dataset)")

subplot(2, 2, 4)
hold on
bins = 0:30:300;
histogram(nllData.minfvalsCov/100, bins, DisplayName='cov model')
histogram(nllData.minfvalsInd/100, bins, DisplayName='ind model')
hold off
ylabel("Count")
xlabel("NLL")
legend
title("bestfit fvals (train dataset)")


